(program mpz_ifequal ((v1 mpz) (v mpz) (t term) (s term)) term
  (mp_ifzero (mp_add (mp_neg v1) v) t s)
)

(program sub ((t term) (v mpz) (s term)) term
  (match t
    ((bvar v1 u1) 
       (mpz_ifequal v v1 s t))
    ((apply t1 t2) (apply (sub t1 v s) (sub t2 v s)))
    (default t)
  ))

(program sub_and_type_check ((t term) (v mpz) (s term) (u sort)) term
  (match (type_check s)
    (u (sub t v s))))

(declare instantiate (! matrix term
                     (! v mpz
                     (! u sort
                     (! s term
                     (! matrixi term
                     (! p (th_holds (apply (forall v u) matrix))
;                     (! r1 (^ (type_check s) u)
;                     (! r2 (^ (sub matrix v s) matrixi)
                     (! r (^ (sub_and_type_check matrix v s u) matrixi)
                     (th_holds matrixi)))))))))
